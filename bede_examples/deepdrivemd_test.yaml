title: "RbsB_2DRI_test"
resource: local.localhost
queue: gpu
schema_: local
project: ACCOUNT_PROJECT_CODE
walltime_min: 45
max_iteration: 2
cpus_per_node: 30
gpus_per_node: 2
hardware_threads_per_cpu: 4

# -------------------------------------------------------------------------
# PATH CONFIGURATION
# -------------------------------------------------------------------------
# CHANGE <project_code> and <user_name> in this script
experiment_directory: "USER_PROJECT_ROOT/DeepDriveMD-BEDE/bede_examples/output_test"
node_local_path: null

# -------------------------------------------------------------------------
# MOLECULAR DYNAMICS STAGE (OpenMM)
# -------------------------------------------------------------------------
molecular_dynamics_stage:
    pre_exec: []
    executable: 'USER_PROJECT_ROOT/DeepDriveMD-BEDE/bede_examples/run_stage.sh python -m deepdrivemd.sim.openmm.run_openmm'
    arguments: []
    cpu_reqs:
        processes: 1
        process_type: null
        threads_per_process: 4
        thread_type: null
    gpu_reqs:
        processes: 1
        process_type: null
        threads_per_process: 1
        thread_type: null
    num_tasks: 12
    task_config:
        experiment_directory: set_by_deepdrivemd
        stage_idx: 0
        task_idx: 0
        output_path: set_by_deepdrivemd
        node_local_path: set_by_deepdrivemd
        initial_pdb_dir: USER_PROJECT_ROOT/DeepDriveMd-BEDE/bede_examples/data
        pdb_file: "comp.pdb"

        # Add the reference PDB (same as the input PDB for this test)
        reference_pdb_file: "USER_PROJECT_ROOT/DeepDriveMD-BEDE/bede_examples/data/sys1/comp.pdb"
        
        # EXPLICIT PARAMETERS TO FIX UNIT ERROR:
        temperature_kelvin: 310.0
        heat_bath_friction_coef: 1.0
        time_step_ps: 0.002
        simulation_length_ns: 0.1
        report_interval_ps: 5.0
        solvent_type: "implicit"



# -------------------------------------------------------------------------
# AGGREGATION STAGE
# -------------------------------------------------------------------------
aggregation_stage:
    pre_exec: []
    executable: 'USER_PROJECT_ROOT/DeepDriveMD-BEDE/bede_examples/run_stage.sh python -m deepdrivemd.aggregation.basic.aggregate'
    arguments: []
    cpu_reqs:
        processes: 1
        process_type: null
        threads_per_process: 1
        thread_type: null
    gpu_reqs:
        processes: 0
        process_type: null
        threads_per_process: 0
        thread_type: null
    skip_aggregation: false
    task_config:
        experiment_directory: set_by_deepdrivemd
        stage_idx: 0
        task_idx: 0
        output_path: set_by_deepdrivemd
        node_local_path: set_by_deepdrivemd
        output_filename: 'aggregated_data.h5'

# -------------------------------------------------------------------------
# MACHINE LEARNING STAGE (Switched to Keras CVAE)
# -------------------------------------------------------------------------
machine_learning_stage:
    pre_exec: []
    # Pointing to CVAE train script
    executable: 'USER_PROJECT_ROOT/DeepDriveMD-BEDE/bede_examples/run_stage.sh python -m deepdrivemd.models.keras_cvae.train'
    arguments: []
    cpu_reqs:
        processes: 1
        process_type: null
        threads_per_process: 4
        thread_type: null
    gpu_reqs:
        processes: 1
        process_type: null
        threads_per_process: 1
        thread_type: null
    retrain_freq: 1
    task_config:
        experiment_directory: set_by_deepdrivemd
        stage_idx: 0
        task_idx: 0
        output_path: set_by_deepdrivemd
        node_local_path: set_by_deepdrivemd
        model_tag: set_by_deepdrivemd
        init_weights_path: null
        # CVAE specific args
        loss: 'mse'
        optimizer: 'rmsprop'

# -------------------------------------------------------------------------
# MODEL SELECTION STAGE
# -------------------------------------------------------------------------
model_selection_stage:
    pre_exec: []
    executable: 'USER_PROJECT_ROOT/DeepDriveMD-BEDE/bede_examples/run_stage.sh python -m deepdrivemd.selection.latest.select_model'
    arguments: []
    cpu_reqs:
        processes: 1
        process_type: null
        threads_per_process: 1
        thread_type: null
    gpu_reqs:
        processes: 0
        process_type: null
        threads_per_process: 0
        thread_type: null
    task_config:
        experiment_directory: set_by_deepdrivemd
        stage_idx: 0
        task_idx: 0
        output_path: set_by_deepdrivemd
        node_local_path: set_by_deepdrivemd

# -------------------------------------------------------------------------
# AGENT STAGE
# -------------------------------------------------------------------------
agent_stage:
    pre_exec: []
    executable: 'USER_PROJECT_ROOT/DeepDriveMD-BEDE/bede_examples/run_stage.sh python -m deepdrivemd.agents.lof.lof'
    arguments: []
    cpu_reqs:
        processes: 1
        process_type: null
        threads_per_process: 1
        thread_type: null
    gpu_reqs:
        processes: 0
        process_type: null
        threads_per_process: 0
        thread_type: null
    task_config:
        experiment_directory: set_by_deepdrivemd
        stage_idx: 0
        task_idx: 0
        output_path: set_by_deepdrivemd
        node_local_path: set_by_deepdrivemd
